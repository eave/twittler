<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        // This is the display function
        var ref;
        var tweetDisplay = function(user) {
          if (user) {
            ref = streams.users[user];
          } else {
            ref = streams.home;
          }

          $body.empty();
          var index = ref.length - 1;
          while (index >= 0) {
            var tweet = ref[index];
            var $tweet = $('<div>' +
              tweet.created_at +
              '<div class="userName"><a href="#" class="' + tweet.user + '"">' + 
              ' @' + tweet.user + 
              '</a></div>' +
              tweet.message +
              '</div>');
            $tweet.appendTo($body);
            index -= 1;
          }
        };

        // This function refreshes the stream if there are new tweets
        var streamLength, testLength, timer;
        var tweetRefresh = function(callback, frequency, user) {
          timer = setInterval(function() {
            if (user) {
              testLength = streams.users[user].length;
            } else {
              testLength = streams.home.length;
            }

            if (streamLength != testLength)
              callback(user);
            streamLength = testLength;
          }, frequency);
        }

        // This adds filter functionality
        $('body').on('click', 'a', function() {
          var user = this.getAttribute('class');
          clearInterval(timer);
          tweetDisplay(user);
          tweetRefresh(tweetDisplay, 1000, user);
        });


        tweetDisplay();
        tweetRefresh(tweetDisplay, 1000);

      });

    </script>
  </body>
</html>
